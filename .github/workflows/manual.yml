# This is a basic workflow that is manually triggered

name: Manual workflow

# Controls when the action will run. Workflow runs when manually triggered using the UI
# or API.
on:
  push:
#   workflow_dispatch:
#     # Inputs the workflow accepts.
#     inputs:
#       name:
#         # Friendly description to be shown in the UI instead of 'name'
#         description: 'Person to greet'
#         # Default value if no value is explicitly provided
#         default: 'World'
#         # Input has to be provided for the workflow to run
#         required: true

jobs:

  # Gets the changed yaml files from the Deployments directory
  changes:
    continue-on-error: false
    runs-on: self-hosted
    outputs:
      deployments: ${{ steps.filter.outputs.deployments }}
      changedFiles: ${{ steps.filter.outputs.deployments_files }}
    steps:
      # Checkout Repo
      - uses: actions/checkout@v2
      # Set up Filter
      - uses: dorny/paths-filter@v2.9.3
        id: filter
        with:
          list-files: shell
          filters: |
            deployments:
              - added|modified: '**/*.yaml'
          base: 'dev'
          initial-fetch-depth: '10'
          working-directory: 'Deployments'
      - run: |
          test=${{ steps.filter.outputs.deployments_files }} && \
          output=$(go run detectChanges.go $test) && \
          echo $output && \
          echo ::set-output name=directories::$output
      - name: test
        run: echo "Start -- ${{ steps.filter.outputs.changedFiles }} -- End"
#          echo "${{ steps.filter.outputs.changedFiles }}"
#          echo "$(go run detectChanges.go $test)"

  # Uses the changes job to get the unique directories for each change found
#  get_Unique_Directories:
#    continue-on-error: true
#    needs: changes
#    if: ${{ needs.changes.outputs.deployments == 'true' }}
#    runs-on: self-hosted
#    env:
#      directories: ${{ needs.changes.outputs.changedFiles }}
#    steps:
#      # Checkout Repo
#      - uses: actions/checkout@v2
#      # Setup Go
##      - uses: actions/setup-go@v2.1.3
##        with:
##          go-version: '^1.16'
##        id: directories
#      - run: |
#          echo "$(go run detectChanges.go $directories)"
#      - name: Print Value
#        run: echo "${{ steps.directories.get_directories }}"

#  # Prints the unique directories found from the previous step
#  print_Directories:
#    continue-on-error: true
#    needs: changes
#    runs-on: self-hosted
#    steps:
#      - run: echo ${{ needs.changes.outputs.directories }}