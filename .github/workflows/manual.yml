# This is a basic workflow that is manually triggered

name: Manual workflow

# Controls when the action will run. Workflow runs when manually triggered using the UI
# or API.
on:
  push:
  workflow_dispatch:
    # Inputs the workflow accepts.
    inputs:
      name:
        # Friendly description to be shown in the UI instead of 'name'
        description: 'Person to greet'
        # Default value if no value is explicitly provided
        default: 'World'
        # Input has to be provided for the workflow to run
        required: true

jobs:
  changes:
    runs-on: ubuntu-20.04
    outputs:
      deployments: ${{ steps.filter.outputs.deployments }}
    steps:
      - uses: dorny/paths-filter@v2.9.3
        id: filter
        with:
          filters: |
            deployments:
              - 'Deployments/**'
          token: ${{ secrets.ACTION_TOKEN }}
  changesTrue:
    needs: changes
    if: ${{ needs.changes.outputs.deployments == 'true' }}
    runs-on: ubuntu-20.04
    steps:
      - run: echo ${{ needs.changes.outputs.deployments }}
  changesFalse:
    needs: changes
    if: ${{ needs.changes.outputs.deployments == 'false' }}
    runs-on: ubuntu-20.04
    steps:
      - run: echo ${{ needs.changes.outputs.deployments }}
#  get_tags:
#    runs-on: ubuntu-20.04
#    outputs:
#      tagName: ${{ steps.getTags.outputs.tagName }}
#    steps:
#      - id: getTags
#        run: echo "::set-output name=tagName::${GITHUB_REF#refs/*/}"
#  Print_tags:
#    runs-on: ubuntu-20.04
#    needs: get_tags
#    steps:
#      - run: echo ${{needs.get_tags.outputs.tagName}}

#  Prep-Environmnet:
#    runs-on: ubuntu-20.04
#    steps:
#      - name: Prep Environmnet
#      - uses: actions/checkout@v2
#      - uses: actions/setup-go@v2.1.3
#        with:
#          go-version: '^1.16'
#      - name: Replace yaml with secrets
#        env:
#          wp_db_user: ${{ secrets.WP_DB_USER }}
#          wp_db_pass: ${{ secrets.WP_DB_PASS }}
#          adguard_ip: ${{ secrets.ADGUARD_IP }}
#          cachet_db_user: ${{ secrets.CACHET_DB_USER }}
#          cachet_db_pass: ${{ secrets.CACHET_DB_PASS }}
#          phonito_api: ${{ secrets.PHONITO_API }}
#        run: |
#          go run main.go
#      - name: Deploy Adguard
#      uses: actions-hub/kubectl@master
#        env:
#          KUBE_CONFIG: ${{ secrets.KUBE_CONFIG }}
#          KUBECTL_VERSION: "1.20"
#        with:
#          args: apply -k ./Deployments/adguard